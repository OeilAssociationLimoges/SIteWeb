---
import Layout from '../layouts/Layout.astro';
import Agenda from '../components/Agenda.astro';
import NavMenu from "../components/NavMenu"


import IconMapMarker from '~icons/mdi/map-marker'
import IconInformation from '~icons/mdi/information'


import agenda from "../data/agenda.yml";

const events = agenda
  .map(event => ({
    ...event,
    date: new Date(event.date.split("/").reverse().join("-"))
  }))
  .sort((a, b) => a.date.getTime() - b.date.getTime())
  .filter(event => event.date > new Date());

const nextEvent = events.shift();
---

<Layout title="OEIL">
	<div class="h-[400px]">
    <div
      class="absolute top-0 right-0 left-0 bg-black h-[400px] -z-10"
      style="clip-path: polygon(0 0, 100% 0, 100% 90%, 0% 100%)"
    />

    <NavMenu client:load />

    <div class="text-center mt-8 space-y-2 px-6 pt-24">
      <h1 class="text-5xl sm:text-8xl md:text-9xl text-white tracking-[0.25em] font-800 ml-6">
        L'OEIL
      </h1>
      <p class="text-white/80 font-300 tracking-wider">
        L'Organisation des Étudiants en Informatique de Limoges
      </p>
    </div>
  </div>

  <main class="sm:px-6">
    <div class="relative -mt-30 sm:-mt-24 md:-mt-16 z-10 bg-white max-w-[720px] w-full mx-auto border-4 border-black border-x-0 sm:border-x-4 px-6 py-4">
      {nextEvent ? (
        <div class="flex flex-col sm:flex-row sm:items-center sm:gap-2">
          <p class="uppercase font-600">
            Prochain Événement
          </p>
          <div class="h-1 w-1 bg-black rounded-full hidden sm:block" />
          <p class="uppercase font-500">
            {nextEvent.date.toLocaleDateString("fr-FR")}
          </p>
        </div>
  
        <p class="mt-2 font-400 text-sm md:text-base">
          {nextEvent.description}
        </p>
  
        <div class="mt-6 flex items-center gap-2">
          <IconMapMarker class="text-xl" />
          {nextEvent['location-link'] ? (
            <a
              href={nextEvent['location-link']}
              class="font-400 text-black/80 hover:text-black hover:underline hover:underline-offset-2 transition-colors"
              rel="noopener noreferrer"
              target="_blank"
            >
              {nextEvent.location}
            </a>
          ) : (
            <p class="font-300">
              {nextEvent.location}
            </p>
          )}
        </div>
      ) : (
        <div class="flex flex-col items-center gap-2">
          <IconInformation class="text-xl" />
          <p>Aucun événement en cours, revenez plus tard !</p>
        </div>
      )}
    </div>

    <section class="mt-16 px-6">
      <h2 class="font-mono text-center text-4xl tracking-widest">
        # Agenda
      </h2>

      <div class="mt-10 max-w-[640px] border-black border-l-2 mx-auto pb-6 flex flex-col gap-8"
        style="border-image: linear-gradient(#000 0%, #000 92%, #fff 100%) 1;"
      >
        {events.map(event => (
          <Agenda item={event} />
        ))}
      </div>
    </section>

    <section class="py-30"></section>
  </main>
</Layout>
